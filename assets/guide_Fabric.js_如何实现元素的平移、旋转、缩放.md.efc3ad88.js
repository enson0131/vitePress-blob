import{_ as s,o as a,c as n,Q as p}from"./chunks/framework.b6910bb2.js";const l="/vitePress-blob/assets/12.c019413f.png",o="/vitePress-blob/assets/13.591a51f7.png",e="data:image/png;base64,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",t="/vitePress-blob/assets/15.54a5c9c6.gif",d=JSON.parse('{"title":"如何实现元素的平移、旋转、缩放","description":"","frontmatter":{},"headers":[],"relativePath":"guide/Fabric.js/如何实现元素的平移、旋转、缩放.md","filePath":"guide/Fabric.js/如何实现元素的平移、旋转、缩放.md","lastUpdated":1736923006000}'),c={name:"guide/Fabric.js/如何实现元素的平移、旋转、缩放.md"},r=p(`<h1 id="如何实现元素的平移、旋转、缩放" tabindex="-1">如何实现元素的平移、旋转、缩放 <a class="header-anchor" href="#如何实现元素的平移、旋转、缩放" aria-label="Permalink to &quot;如何实现元素的平移、旋转、缩放&quot;">​</a></h1><p>在上一节中，我们知道了元素是如何渲染到 Canvas 的画布上，这一节我们将了解如何对元素进行平移、旋转、缩放。</p><h2 id="如何平移、旋转、缩放元素" tabindex="-1">如何平移、旋转、缩放元素 <a class="header-anchor" href="#如何平移、旋转、缩放元素" aria-label="Permalink to &quot;如何平移、旋转、缩放元素&quot;">​</a></h2><p>在上一节我们知道，元素都继承自 fabric.Object，而 fabric.Object 的 render 方法都由各个元素实现。那么对于元素的平移、旋转、缩放，我们又需要如何抽离出通用的逻辑呢？</p><p>不妨思考一下，这个案例</p><p><code>假设要在 (100, 100) 的地方绘制一个 50*50 的矩形，并将其放大 2 倍，之后旋转 45°，该怎么画呢？</code></p><p>正常逻辑是：</p><ol><li><p>手动算下宽高 100 * 100</p></li><li><p>手动算下旋转之后各个顶点的坐标</p></li><li><p>连接四个顶点，绘制矩形</p></li></ol><p>也就是我们先手动先计算出各个转化后的坐标，通过坐标绘制出图形。</p><p>但在 Canvas 中，<em><strong>要改掉这种绘制的思想，而是要通过并善用变换坐标系来绘制物体</strong></em></p><p>思路如下: 1 绘制一个 50*50 的矩形</p><p>2 转化坐标系</p><p>代码如下:</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">// 之前提到过了，你要修改 ctx 上的一些配置或者画一个物体，最好先 save 一下，这是个好习惯</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">translate</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 此时原点已经变到了 (100, 100) 的地方</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">scale</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">); </span><span style="color:#6A737D;">// 坐标系放大两倍</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">rotate</span><span style="color:#E1E4E8;">(Util.</span><span style="color:#B392F0;">degreesToRadians</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">45</span><span style="color:#E1E4E8;">)); </span><span style="color:#6A737D;">// 注意 canvas 中用的都是弧度（弧度 / 2 * Math.PI = 角度 / 360)，所以需要简单换算下</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">fillRect</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">width</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, height</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, width, height); </span><span style="color:#6A737D;">// 绘制矩形的方法固定不变，宽高一般也不会去修改</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">restore</span><span style="color:#E1E4E8;">(); </span><span style="color:#6A737D;">// 画完之后还原 ctx 状态，这是个好习惯</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">// 之前提到过了，你要修改 ctx 上的一些配置或者画一个物体，最好先 save 一下，这是个好习惯</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">translate</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 此时原点已经变到了 (100, 100) 的地方</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">scale</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">); </span><span style="color:#6A737D;">// 坐标系放大两倍</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">rotate</span><span style="color:#24292E;">(Util.</span><span style="color:#6F42C1;">degreesToRadians</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">45</span><span style="color:#24292E;">)); </span><span style="color:#6A737D;">// 注意 canvas 中用的都是弧度（弧度 / 2 * Math.PI = 角度 / 360)，所以需要简单换算下</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">fillRect</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">width</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, height</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, width, height); </span><span style="color:#6A737D;">// 绘制矩形的方法固定不变，宽高一般也不会去修改</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">restore</span><span style="color:#24292E;">(); </span><span style="color:#6A737D;">// 画完之后还原 ctx 状态，这是个好习惯</span></span></code></pre></div><p><img src="`+l+`" alt="alt text"></p><p><em><strong>尽量不去改变物体的宽高和大小，而是通过各种变换来达到所需要的效果</strong></em></p><h2 id="矩阵运算" tabindex="-1">矩阵运算 <a class="header-anchor" href="#矩阵运算" aria-label="Permalink to &quot;矩阵运算&quot;">​</a></h2><p>在 Fabric.js 中，并不是通过 translate、scale、rotate 这些方法来实现元素的平移、旋转、缩放，而是通过矩阵运算来实现。</p><p>通过 transform api 做矩阵变化，参数 是一个数组，里面有6个元素，默认值是 [1, 0, 0, 1, 0, 0]。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">]: 水平缩放（x轴方向）</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">]: 水平倾斜（x轴方向）</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">]: 垂直倾斜（y轴方向）</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">]: 垂直缩放（y轴方向）</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">]: 水平移动（x轴方向）</span></span>
<span class="line"><span style="color:#E1E4E8;">[</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">]: 垂直移动（y轴方向</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">]: 水平缩放（x轴方向）</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">1</span><span style="color:#24292E;">]: 水平倾斜（x轴方向）</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">]: 垂直倾斜（y轴方向）</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">]: 垂直缩放（y轴方向）</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">]: 水平移动（x轴方向）</span></span>
<span class="line"><span style="color:#24292E;">[</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">]: 垂直移动（y轴方向</span></span></code></pre></div><p>1 修改 viewportTransform[0]、viewportTransform[3] 达到缩放横纵坐标的值</p><p>2 修改 viewportTransform[4]、viewportTransform[5] 达到平移画布的效果</p><p><img src="`+o+`" alt="alt text"></p><p>对于上面这个例子，我们只需要修改 viewportTransform 的值，然后重新渲染画布就好了。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">width</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">height</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">angle</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> (</span><span style="color:#79B8FF;">45</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">/</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">180</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#79B8FF;">PI</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// Math.PI / 4</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">save</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">transform</span><span style="color:#E1E4E8;">( </span><span style="color:#6A737D;">// 旋转</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">cos</span><span style="color:#E1E4E8;">(angle),</span></span>
<span class="line"><span style="color:#E1E4E8;">  Math.</span><span style="color:#B392F0;">sin</span><span style="color:#E1E4E8;">(angle),</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">Math.</span><span style="color:#B392F0;">sin</span><span style="color:#E1E4E8;">(angle),</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">*</span><span style="color:#E1E4E8;"> Math.</span><span style="color:#B392F0;">cos</span><span style="color:#E1E4E8;">(angle),</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">fillRect</span><span style="color:#E1E4E8;">(</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">width</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, height</span><span style="color:#F97583;">/</span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">, width, height); </span><span style="color:#6A737D;">// 绘制矩形的方法固定不变，宽高一般也不会去修改</span></span>
<span class="line"><span style="color:#E1E4E8;">ctx.</span><span style="color:#B392F0;">restore</span><span style="color:#E1E4E8;">();</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">width</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">height</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">50</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">angle</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> (</span><span style="color:#005CC5;">45</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">/</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">180</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> Math.</span><span style="color:#005CC5;">PI</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// Math.PI / 4</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">save</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">transform</span><span style="color:#24292E;">( </span><span style="color:#6A737D;">// 旋转</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">cos</span><span style="color:#24292E;">(angle),</span></span>
<span class="line"><span style="color:#24292E;">  Math.</span><span style="color:#6F42C1;">sin</span><span style="color:#24292E;">(angle),</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">-</span><span style="color:#24292E;">Math.</span><span style="color:#6F42C1;">sin</span><span style="color:#24292E;">(angle),</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">*</span><span style="color:#24292E;"> Math.</span><span style="color:#6F42C1;">cos</span><span style="color:#24292E;">(angle),</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#005CC5;">100</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">fillRect</span><span style="color:#24292E;">(</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">width</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, height</span><span style="color:#D73A49;">/</span><span style="color:#005CC5;">2</span><span style="color:#24292E;">, width, height); </span><span style="color:#6A737D;">// 绘制矩形的方法固定不变，宽高一般也不会去修改</span></span>
<span class="line"><span style="color:#24292E;">ctx.</span><span style="color:#6F42C1;">restore</span><span style="color:#24292E;">();</span></span></code></pre></div><p><img src="`+e+`" alt="alt text"></p><p>同样的，在 fabric.js 中，在 render 方法中，会调用 transform 方法，将 viewportTransform 的值设置为 transform 的值，以达到对元素进行平移、旋转、缩放的效果。</p><h2 id="如何实现漫游" tabindex="-1">如何实现漫游 <a class="header-anchor" href="#如何实现漫游" aria-label="Permalink to &quot;如何实现漫游&quot;">​</a></h2><p>通过监听滚轮事件，然后修改 viewportTransform 的值，以达到对画布进行平移的效果。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">canvas.</span><span style="color:#B392F0;">on</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;mouse:wheel&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">opt</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">   onsole.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;opt&quot;</span><span style="color:#E1E4E8;">, opt);</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">deltaY</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> opt.e.deltaY;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">deltaX</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> opt.e.deltaX;</span></span>
<span class="line"><span style="color:#E1E4E8;">   zoom </span><span style="color:#F97583;">*=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.999</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">**</span><span style="color:#E1E4E8;"> deltaY;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (zoom </span><span style="color:#F97583;">&gt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">) zoom </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">20</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (zoom </span><span style="color:#F97583;">&lt;</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.01</span><span style="color:#E1E4E8;">) zoom </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">0.01</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">vpt</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.viewportTransform;</span></span>
<span class="line"><span style="color:#E1E4E8;">   console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;vpt&quot;</span><span style="color:#E1E4E8;">, vpt);</span></span>
<span class="line"><span style="color:#E1E4E8;">   vpt[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> zoom; </span><span style="color:#6A737D;">// 在 X 轴方向上的偏移量。</span></span>
<span class="line"><span style="color:#E1E4E8;">   vpt[</span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> zoom; </span><span style="color:#6A737D;">// 在 Y 轴方向上的偏移量。</span></span>
<span class="line"><span style="color:#E1E4E8;">   vpt[</span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> deltaX; </span><span style="color:#6A737D;">// 俩个点的位置差</span></span>
<span class="line"><span style="color:#E1E4E8;">   vpt[</span><span style="color:#79B8FF;">5</span><span style="color:#E1E4E8;">] </span><span style="color:#F97583;">+=</span><span style="color:#E1E4E8;"> deltaY; </span><span style="color:#6A737D;">// 俩个点的位置差</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">requestRenderAll</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">setViewportTransform</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;">.viewportTransform);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// let zoom = canvas.getZoom();</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// zoom *= 0.999 ** delta;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// if (zoom &gt; 20) zoom = 20;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// if (zoom &lt; 0.01) zoom = 0.01;</span></span>
<span class="line"><span style="color:#E1E4E8;">   </span><span style="color:#6A737D;">// canvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);</span></span>
<span class="line"><span style="color:#E1E4E8;">   opt.e.</span><span style="color:#B392F0;">preventDefault</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">   opt.e.</span><span style="color:#B392F0;">stopPropagation</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">canvas.</span><span style="color:#6F42C1;">on</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;mouse:wheel&quot;</span><span style="color:#24292E;">, </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">opt</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">   onsole.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;opt&quot;</span><span style="color:#24292E;">, opt);</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">deltaY</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> opt.e.deltaY;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">deltaX</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> opt.e.deltaX;</span></span>
<span class="line"><span style="color:#24292E;">   zoom </span><span style="color:#D73A49;">*=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.999</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">**</span><span style="color:#24292E;"> deltaY;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (zoom </span><span style="color:#D73A49;">&gt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">) zoom </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">20</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (zoom </span><span style="color:#D73A49;">&lt;</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.01</span><span style="color:#24292E;">) zoom </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">0.01</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">vpt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.viewportTransform;</span></span>
<span class="line"><span style="color:#24292E;">   console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;vpt&quot;</span><span style="color:#24292E;">, vpt);</span></span>
<span class="line"><span style="color:#24292E;">   vpt[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> zoom; </span><span style="color:#6A737D;">// 在 X 轴方向上的偏移量。</span></span>
<span class="line"><span style="color:#24292E;">   vpt[</span><span style="color:#005CC5;">3</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> zoom; </span><span style="color:#6A737D;">// 在 Y 轴方向上的偏移量。</span></span>
<span class="line"><span style="color:#24292E;">   vpt[</span><span style="color:#005CC5;">4</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> deltaX; </span><span style="color:#6A737D;">// 俩个点的位置差</span></span>
<span class="line"><span style="color:#24292E;">   vpt[</span><span style="color:#005CC5;">5</span><span style="color:#24292E;">] </span><span style="color:#D73A49;">+=</span><span style="color:#24292E;"> deltaY; </span><span style="color:#6A737D;">// 俩个点的位置差</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">requestRenderAll</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">setViewportTransform</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">this</span><span style="color:#24292E;">.viewportTransform);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// let zoom = canvas.getZoom();</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// zoom *= 0.999 ** delta;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// if (zoom &gt; 20) zoom = 20;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// if (zoom &lt; 0.01) zoom = 0.01;</span></span>
<span class="line"><span style="color:#24292E;">   </span><span style="color:#6A737D;">// canvas.zoomToPoint({ x: opt.e.offsetX, y: opt.e.offsetY }, zoom);</span></span>
<span class="line"><span style="color:#24292E;">   opt.e.</span><span style="color:#6F42C1;">preventDefault</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">   opt.e.</span><span style="color:#6F42C1;">stopPropagation</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>演示效果👇:</p><p><img src="`+t+'" alt="alt text"></p><p>演示地址: <a href="https://enson0131.github.io/mini-fabric-whiteboard/" target="_blank" rel="noreferrer">https://enson0131.github.io/mini-fabric-whiteboard/</a></p><h2 id="仓库案例" tabindex="-1">仓库案例 <a class="header-anchor" href="#仓库案例" aria-label="Permalink to &quot;仓库案例&quot;">​</a></h2><p><a href="https://github.com/enson0131/mini-fabric-whiteboard/blob/master/mini-fabric/src/fabric/FabricObject.ts#L212" target="_blank" rel="noreferrer">https://github.com/enson0131/mini-fabric-whiteboard/blob/master/mini-fabric/src/fabric/FabricObject.ts#L212</a></p><h2 id="参考文档" tabindex="-1">参考文档 <a class="header-anchor" href="#参考文档" aria-label="Permalink to &quot;参考文档&quot;">​</a></h2><ul><li><a href="https://medium.com/@sagarmohanty2k00/creating-a-digital-whiteboard-element-with-react-js-d4924ee2c58e" target="_blank" rel="noreferrer">https://medium.com/@sagarmohanty2k00/creating-a-digital-whiteboard-element-with-react-js-d4924ee2c58e</a></li><li><a href="https://fabricjs.com/docs/old-docs/fabric-intro-part-5/" target="_blank" rel="noreferrer">https://fabricjs.com/docs/old-docs/fabric-intro-part-5/</a></li><li><a href="https://juejin.cn/post/7106023188831666206" target="_blank" rel="noreferrer">https://juejin.cn/post/7106023188831666206</a></li><li><a href="https://juejin.cn/post/7142664492122374158?from=search-suggest" target="_blank" rel="noreferrer">https://juejin.cn/post/7142664492122374158?from=search-suggest</a></li><li><a href="https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/transform#matrix" target="_blank" rel="noreferrer">https://developer.mozilla.org/zh-CN/docs/Web/SVG/Attribute/transform#matrix</a></li></ul>',37),E=[r];function y(A,i,C,g,F,h){return a(),n("div",null,E)}const m=s(c,[["render",y]]);export{d as __pageData,m as default};
