import{_ as s,o as n,c as a,Q as l}from"./chunks/framework.b6910bb2.js";const p="/vitePress-blob/assets/15.843ebff4.png",o="/vitePress-blob/assets/16.1c535fdb.png",e="/vitePress-blob/assets/17.b5f79e7e.png",t="/vitePress-blob/assets/18.cdfcf7d2.png",b=JSON.parse('{"title":"如何解析 zip 文件","description":"","frontmatter":{},"headers":[],"relativePath":"guide/二进制/zip 包解析原理.md","filePath":"guide/二进制/zip 包解析原理.md","lastUpdated":1762676671000}'),c={name:"guide/二进制/zip 包解析原理.md"},r=l('<h1 id="如何解析-zip-文件" tabindex="-1">如何解析 zip 文件 <a class="header-anchor" href="#如何解析-zip-文件" aria-label="Permalink to &quot;如何解析 zip 文件&quot;">​</a></h1><h2 id="什么是-zip-文件" tabindex="-1">什么是 zip 文件 <a class="header-anchor" href="#什么是-zip-文件" aria-label="Permalink to &quot;什么是 zip 文件&quot;">​</a></h2><p>zip 文件是一种压缩文件格式，它可以将多个文件压缩成一个文件，从而节省空间。</p><h2 id="如何解析" tabindex="-1">如何解析 <a class="header-anchor" href="#如何解析" aria-label="Permalink to &quot;如何解析&quot;">​</a></h2><p>在解析 zip 文件之前，我们在项目中创建了一个 zip 文件，并添加了 1 个 txt 文件。</p><p><img src="'+p+`" alt="zip 文件"></p><p><a href="https://github.com/enson0131/learn/raw/refs/heads/main/%E6%96%87%E4%BB%B6%E7%9B%B8%E5%85%B3/jszip/hello.txt.zip" target="_blank" rel="noreferrer">本文的 zip 案例文件</a></p><h2 id="读取-zip-文件内容" tabindex="-1">读取 zip 文件内容 <a class="header-anchor" href="#读取-zip-文件内容" aria-label="Permalink to &quot;读取 zip 文件内容&quot;">​</a></h2><div class="language-html vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">&lt;</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;上传一个zip文件，并在控制台查看内存存储方式&lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">input</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">id</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;uploadInput&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">type</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;file&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">multiple</span><span style="color:#E1E4E8;">=</span><span style="color:#9ECBFF;">&quot;&quot;</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#85E89D;">br</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">div</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">uploadInput</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> document.</span><span style="color:#B392F0;">getElementById</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;uploadInput&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"><span style="color:#E1E4E8;">        uploadInput.</span><span style="color:#B392F0;">addEventListener</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#9ECBFF;">&quot;change&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">            () </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">file</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> uploadInput.files[</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">];</span></span>
<span class="line"><span style="color:#E1E4E8;">                console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;File 对象，只读不能写：&#39;</span><span style="color:#E1E4E8;">, file)</span></span>
<span class="line"><span style="color:#E1E4E8;">                </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">reader</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">FileReader</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">                reader.</span><span style="color:#B392F0;">onload</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Array Buffer对象，不能读写：&#39;</span><span style="color:#E1E4E8;">, e.target.result)</span></span>
<span class="line"><span style="color:#E1E4E8;">                    </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">uint8arr</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">Uint8Array</span><span style="color:#E1E4E8;">(e.target.result);</span></span>
<span class="line"><span style="color:#E1E4E8;">                    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&#39;Uint8Array对象，可读写：&#39;</span><span style="color:#E1E4E8;">, uint8arr);</span></span>
<span class="line"><span style="color:#E1E4E8;">                };</span></span>
<span class="line"><span style="color:#E1E4E8;">                reader.</span><span style="color:#B392F0;">onerror</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> (</span><span style="color:#FFAB70;">e</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">                    console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;error&quot;</span><span style="color:#E1E4E8;">, e.target.error);</span></span>
<span class="line"><span style="color:#E1E4E8;">                };</span></span>
<span class="line"><span style="color:#E1E4E8;">                reader.</span><span style="color:#B392F0;">readAsArrayBuffer</span><span style="color:#E1E4E8;">(file);</span></span>
<span class="line"><span style="color:#E1E4E8;">            },</span></span>
<span class="line"><span style="color:#E1E4E8;">            </span><span style="color:#79B8FF;">false</span></span>
<span class="line"><span style="color:#E1E4E8;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">script</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">&lt;/</span><span style="color:#85E89D;">body</span><span style="color:#E1E4E8;">&gt;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">&lt;</span><span style="color:#22863A;">body</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;上传一个zip文件，并在控制台查看内存存储方式&lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">input</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">id</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;uploadInput&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">type</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;file&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">multiple</span><span style="color:#24292E;">=</span><span style="color:#032F62;">&quot;&quot;</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#22863A;">br</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">div</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">uploadInput</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> document.</span><span style="color:#6F42C1;">getElementById</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;uploadInput&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"><span style="color:#24292E;">        uploadInput.</span><span style="color:#6F42C1;">addEventListener</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#032F62;">&quot;change&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">            () </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">file</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> uploadInput.files[</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">];</span></span>
<span class="line"><span style="color:#24292E;">                console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;File 对象，只读不能写：&#39;</span><span style="color:#24292E;">, file)</span></span>
<span class="line"><span style="color:#24292E;">                </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">reader</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">FileReader</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">                reader.</span><span style="color:#6F42C1;">onload</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Array Buffer对象，不能读写：&#39;</span><span style="color:#24292E;">, e.target.result)</span></span>
<span class="line"><span style="color:#24292E;">                    </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">uint8arr</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">Uint8Array</span><span style="color:#24292E;">(e.target.result);</span></span>
<span class="line"><span style="color:#24292E;">                    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&#39;Uint8Array对象，可读写：&#39;</span><span style="color:#24292E;">, uint8arr);</span></span>
<span class="line"><span style="color:#24292E;">                };</span></span>
<span class="line"><span style="color:#24292E;">                reader.</span><span style="color:#6F42C1;">onerror</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> (</span><span style="color:#E36209;">e</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">                    console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;error&quot;</span><span style="color:#24292E;">, e.target.error);</span></span>
<span class="line"><span style="color:#24292E;">                };</span></span>
<span class="line"><span style="color:#24292E;">                reader.</span><span style="color:#6F42C1;">readAsArrayBuffer</span><span style="color:#24292E;">(file);</span></span>
<span class="line"><span style="color:#24292E;">            },</span></span>
<span class="line"><span style="color:#24292E;">            </span><span style="color:#005CC5;">false</span></span>
<span class="line"><span style="color:#24292E;">        );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">script</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">&lt;/</span><span style="color:#22863A;">body</span><span style="color:#24292E;">&gt;</span></span></code></pre></div><p><img src="`+o+`" alt="读取 zip 文件内容"></p><h2 id="zip-文件协议格式" tabindex="-1">zip 文件协议格式 <a class="header-anchor" href="#zip-文件协议格式" aria-label="Permalink to &quot;zip 文件协议格式&quot;">​</a></h2><p>zip文件官方规范可以看这里。从 <a href="https://pkware.cachefly.net/webdocs/casestudies/APPNOTE.TXT" target="_blank" rel="noreferrer">官方文档</a> 可以看出，</p><p>组成标准zip文件：本地文件头 + 中央目录头 + 中央目录记录结尾。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">[local file header </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">// 本地文件头</span></span>
<span class="line"><span style="color:#E1E4E8;">[file data </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[local file header </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">// 本地文件头</span></span>
<span class="line"><span style="color:#E1E4E8;">[file data </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[local file header </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">// 本地文件头</span></span>
<span class="line"><span style="color:#E1E4E8;">[file data </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[central directory header </span><span style="color:#79B8FF;">1</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">// 中央目录头</span></span>
<span class="line"><span style="color:#E1E4E8;">[central directory header </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">// 中央目录头</span></span>
<span class="line"><span style="color:#E1E4E8;">[central directory header </span><span style="color:#79B8FF;">3</span><span style="color:#E1E4E8;">] </span><span style="color:#6A737D;">// 中央目录头</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">[end </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> central directory record] </span><span style="color:#6A737D;">// 中央目录记录结尾</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">[local file header </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">// 本地文件头</span></span>
<span class="line"><span style="color:#24292E;">[file data </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[local file header </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">// 本地文件头</span></span>
<span class="line"><span style="color:#24292E;">[file data </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[local file header </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">// 本地文件头</span></span>
<span class="line"><span style="color:#24292E;">[file data </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">] </span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[central directory header </span><span style="color:#005CC5;">1</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">// 中央目录头</span></span>
<span class="line"><span style="color:#24292E;">[central directory header </span><span style="color:#005CC5;">2</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">// 中央目录头</span></span>
<span class="line"><span style="color:#24292E;">[central directory header </span><span style="color:#005CC5;">3</span><span style="color:#24292E;">] </span><span style="color:#6A737D;">// 中央目录头</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">[end </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> central directory record] </span><span style="color:#6A737D;">// 中央目录记录结尾</span></span></code></pre></div><h3 id="本地文件头" tabindex="-1">本地文件头 <a class="header-anchor" href="#本地文件头" aria-label="Permalink to &quot;本地文件头&quot;">​</a></h3><p>本地文件头是 zip 文件的第一个部分，它包含了文件的名称、大小、压缩方式等信息。其格式如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">local file header signature     </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">bytes</span><span style="color:#E1E4E8;">  (</span><span style="color:#79B8FF;">0x04034b50</span><span style="color:#E1E4E8;">) </span><span style="color:#6A737D;">// 本地文件头签名</span></span>
<span class="line"><span style="color:#E1E4E8;">version needed to extract       </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 版本需要提取</span></span>
<span class="line"><span style="color:#E1E4E8;">general purpose bit flag        </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 通用目的位标志</span></span>
<span class="line"><span style="color:#E1E4E8;">compression method              </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 压缩方法</span></span>
<span class="line"><span style="color:#E1E4E8;">last mod file time              </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 最后修改文件时间</span></span>
<span class="line"><span style="color:#E1E4E8;">last mod file date              </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 最后修改文件日期</span></span>
<span class="line"><span style="color:#E1E4E8;">crc</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">                          </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// CRC-32</span></span>
<span class="line"><span style="color:#E1E4E8;">compressed size                 </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 压缩大小</span></span>
<span class="line"><span style="color:#E1E4E8;">uncompressed size               </span><span style="color:#79B8FF;">4</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 未压缩大小</span></span>
<span class="line"><span style="color:#E1E4E8;">file name length                </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 文件名称长度</span></span>
<span class="line"><span style="color:#E1E4E8;">extra field length              </span><span style="color:#79B8FF;">2</span><span style="color:#E1E4E8;"> bytes </span><span style="color:#6A737D;">// 额外字段长度</span></span>
<span class="line"><span style="color:#E1E4E8;">file </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;"> (variable size) </span><span style="color:#6A737D;">// 文件名称 (可变大小)</span></span>
<span class="line"><span style="color:#E1E4E8;">extra </span><span style="color:#B392F0;">field</span><span style="color:#E1E4E8;"> (variable size) </span><span style="color:#6A737D;">// 额外字段 (可变大小)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">local file header signature     </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">bytes</span><span style="color:#24292E;">  (</span><span style="color:#005CC5;">0x04034b50</span><span style="color:#24292E;">) </span><span style="color:#6A737D;">// 本地文件头签名</span></span>
<span class="line"><span style="color:#24292E;">version needed to extract       </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 版本需要提取</span></span>
<span class="line"><span style="color:#24292E;">general purpose bit flag        </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 通用目的位标志</span></span>
<span class="line"><span style="color:#24292E;">compression method              </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 压缩方法</span></span>
<span class="line"><span style="color:#24292E;">last mod file time              </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 最后修改文件时间</span></span>
<span class="line"><span style="color:#24292E;">last mod file date              </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 最后修改文件日期</span></span>
<span class="line"><span style="color:#24292E;">crc</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">                          </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// CRC-32</span></span>
<span class="line"><span style="color:#24292E;">compressed size                 </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 压缩大小</span></span>
<span class="line"><span style="color:#24292E;">uncompressed size               </span><span style="color:#005CC5;">4</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 未压缩大小</span></span>
<span class="line"><span style="color:#24292E;">file name length                </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 文件名称长度</span></span>
<span class="line"><span style="color:#24292E;">extra field length              </span><span style="color:#005CC5;">2</span><span style="color:#24292E;"> bytes </span><span style="color:#6A737D;">// 额外字段长度</span></span>
<span class="line"><span style="color:#24292E;">file </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;"> (variable size) </span><span style="color:#6A737D;">// 文件名称 (可变大小)</span></span>
<span class="line"><span style="color:#24292E;">extra </span><span style="color:#6F42C1;">field</span><span style="color:#24292E;"> (variable size) </span><span style="color:#6A737D;">// 额外字段 (可变大小)</span></span></code></pre></div><p>以当前的 zip 文件为例，我们可以看到本地文件头的内容如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">local file header </span><span style="color:#B392F0;">signature</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;"> 4</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 本地文件头签名，因为是小端模式，也就是 16 进制的 0x04034b50</span></span>
<span class="line"><span style="color:#E1E4E8;">Version needed to </span><span style="color:#B392F0;">extract</span><span style="color:#E1E4E8;">: 0</span><span style="color:#79B8FF;">A</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 10</span></span>
<span class="line"><span style="color:#E1E4E8;">general purpose bit </span><span style="color:#B392F0;">flag</span><span style="color:#E1E4E8;">:  </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 通用目的位标志</span></span>
<span class="line"><span style="color:#E1E4E8;">compression </span><span style="color:#B392F0;">method</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 压缩方法</span></span>
<span class="line"><span style="color:#E1E4E8;">last mod file </span><span style="color:#B392F0;">time</span><span style="color:#E1E4E8;">: 1</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> 7</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 最后修改文件时间</span></span>
<span class="line"><span style="color:#E1E4E8;">last mod file </span><span style="color:#B392F0;">date</span><span style="color:#E1E4E8;">: 4</span><span style="color:#79B8FF;">F</span><span style="color:#E1E4E8;"> 5</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 最后修改文件日期</span></span>
<span class="line"><span style="color:#E1E4E8;">crc</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">52</span><span style="color:#E1E4E8;"> 9</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">D6</span><span style="color:#E1E4E8;"> 8</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// CRC-32</span></span>
<span class="line"><span style="color:#E1E4E8;">compressed </span><span style="color:#B392F0;">size</span><span style="color:#E1E4E8;">: 0</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 压缩大小</span></span>
<span class="line"><span style="color:#E1E4E8;">uncompressed </span><span style="color:#B392F0;">size</span><span style="color:#E1E4E8;">: 0</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 未压缩大小</span></span>
<span class="line"><span style="color:#E1E4E8;">file name </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">09</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 文件名称长度</span></span>
<span class="line"><span style="color:#E1E4E8;">extra field </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;">: 1</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 额外字段长度</span></span>
<span class="line"><span style="color:#E1E4E8;">file </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">68</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">65</span><span style="color:#E1E4E8;"> 6</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> 6</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> 6</span><span style="color:#79B8FF;">F</span><span style="color:#E1E4E8;"> 2</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">74</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">78</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">74</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 文件名称</span></span>
<span class="line"><span style="color:#E1E4E8;">extra </span><span style="color:#B392F0;">field</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 额外字段 这里可以根据 extra field length 的长度获取</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// file Data..</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">local file header </span><span style="color:#6F42C1;">signature</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;"> 4</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 本地文件头签名，因为是小端模式，也就是 16 进制的 0x04034b50</span></span>
<span class="line"><span style="color:#24292E;">Version needed to </span><span style="color:#6F42C1;">extract</span><span style="color:#24292E;">: 0</span><span style="color:#005CC5;">A</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 10</span></span>
<span class="line"><span style="color:#24292E;">general purpose bit </span><span style="color:#6F42C1;">flag</span><span style="color:#24292E;">:  </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 通用目的位标志</span></span>
<span class="line"><span style="color:#24292E;">compression </span><span style="color:#6F42C1;">method</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 压缩方法</span></span>
<span class="line"><span style="color:#24292E;">last mod file </span><span style="color:#6F42C1;">time</span><span style="color:#24292E;">: 1</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> 7</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 最后修改文件时间</span></span>
<span class="line"><span style="color:#24292E;">last mod file </span><span style="color:#6F42C1;">date</span><span style="color:#24292E;">: 4</span><span style="color:#005CC5;">F</span><span style="color:#24292E;"> 5</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 最后修改文件日期</span></span>
<span class="line"><span style="color:#24292E;">crc</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">52</span><span style="color:#24292E;"> 9</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">D6</span><span style="color:#24292E;"> 8</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// CRC-32</span></span>
<span class="line"><span style="color:#24292E;">compressed </span><span style="color:#6F42C1;">size</span><span style="color:#24292E;">: 0</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 压缩大小</span></span>
<span class="line"><span style="color:#24292E;">uncompressed </span><span style="color:#6F42C1;">size</span><span style="color:#24292E;">: 0</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 未压缩大小</span></span>
<span class="line"><span style="color:#24292E;">file name </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">09</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 文件名称长度</span></span>
<span class="line"><span style="color:#24292E;">extra field </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;">: 1</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 额外字段长度</span></span>
<span class="line"><span style="color:#24292E;">file </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">68</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">65</span><span style="color:#24292E;"> 6</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> 6</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> 6</span><span style="color:#005CC5;">F</span><span style="color:#24292E;"> 2</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">74</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">78</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">74</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 文件名称</span></span>
<span class="line"><span style="color:#24292E;">extra </span><span style="color:#6F42C1;">field</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 额外字段 这里可以根据 extra field length 的长度获取</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// file Data..</span></span></code></pre></div><h3 id="中央目录头" tabindex="-1">中央目录头 <a class="header-anchor" href="#中央目录头" aria-label="Permalink to &quot;中央目录头&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">central file header signature   4 bytes  (0x02014b50)</span></span>
<span class="line"><span style="color:#e1e4e8;">version made by                 2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">version needed to extract       2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">general purpose bit flag        2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">compression method              2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">last mod file time              2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">last mod file date              2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">crc-32                          4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">compressed size                 4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">uncompressed size               4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">file name length                2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">extra field length              2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">file comment length             2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">disk number start               2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">internal file attributes        2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">external file attributes        4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">relative offset of local header 4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;"></span></span>
<span class="line"><span style="color:#e1e4e8;">file name (variable size)</span></span>
<span class="line"><span style="color:#e1e4e8;">extra field (variable size)</span></span>
<span class="line"><span style="color:#e1e4e8;">file comment (variable size)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">central file header signature   4 bytes  (0x02014b50)</span></span>
<span class="line"><span style="color:#24292e;">version made by                 2 bytes</span></span>
<span class="line"><span style="color:#24292e;">version needed to extract       2 bytes</span></span>
<span class="line"><span style="color:#24292e;">general purpose bit flag        2 bytes</span></span>
<span class="line"><span style="color:#24292e;">compression method              2 bytes</span></span>
<span class="line"><span style="color:#24292e;">last mod file time              2 bytes</span></span>
<span class="line"><span style="color:#24292e;">last mod file date              2 bytes</span></span>
<span class="line"><span style="color:#24292e;">crc-32                          4 bytes</span></span>
<span class="line"><span style="color:#24292e;">compressed size                 4 bytes</span></span>
<span class="line"><span style="color:#24292e;">uncompressed size               4 bytes</span></span>
<span class="line"><span style="color:#24292e;">file name length                2 bytes</span></span>
<span class="line"><span style="color:#24292e;">extra field length              2 bytes</span></span>
<span class="line"><span style="color:#24292e;">file comment length             2 bytes</span></span>
<span class="line"><span style="color:#24292e;">disk number start               2 bytes</span></span>
<span class="line"><span style="color:#24292e;">internal file attributes        2 bytes</span></span>
<span class="line"><span style="color:#24292e;">external file attributes        4 bytes</span></span>
<span class="line"><span style="color:#24292e;">relative offset of local header 4 bytes</span></span>
<span class="line"><span style="color:#24292e;"></span></span>
<span class="line"><span style="color:#24292e;">file name (variable size)</span></span>
<span class="line"><span style="color:#24292e;">extra field (variable size)</span></span>
<span class="line"><span style="color:#24292e;">file comment (variable size)</span></span></code></pre></div><p>大部分字段本地文件头协议差不多，需要留意的是 relative offset of local header 字段，他标识了本地文件头的所在位置。</p><p>以当前的 zip 文件为例，我们可以看到 中央目录头 的内容如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">central file header </span><span style="color:#B392F0;">signature</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;"> 4</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">02</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 中央目录头标识</span></span>
<span class="line"><span style="color:#E1E4E8;">version made </span><span style="color:#B392F0;">by</span><span style="color:#E1E4E8;">: 1</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span></span>
<span class="line"><span style="color:#E1E4E8;">version needed to </span><span style="color:#B392F0;">extract</span><span style="color:#E1E4E8;">: 0</span><span style="color:#79B8FF;">A</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">general purpose bit </span><span style="color:#B392F0;">flag</span><span style="color:#E1E4E8;">:  </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">compression </span><span style="color:#B392F0;">method</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">last mod file </span><span style="color:#B392F0;">time</span><span style="color:#E1E4E8;">: 1</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> 7</span><span style="color:#79B8FF;">C</span></span>
<span class="line"><span style="color:#E1E4E8;">last mod file </span><span style="color:#B392F0;">date</span><span style="color:#E1E4E8;">: 4</span><span style="color:#79B8FF;">F</span><span style="color:#E1E4E8;"> 5</span><span style="color:#79B8FF;">B</span></span>
<span class="line"><span style="color:#E1E4E8;">crc</span><span style="color:#F97583;">-</span><span style="color:#79B8FF;">32</span><span style="color:#E1E4E8;">            : </span><span style="color:#79B8FF;">52</span><span style="color:#E1E4E8;"> 9</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">D6</span><span style="color:#E1E4E8;"> 8</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">compressed </span><span style="color:#B392F0;">size</span><span style="color:#E1E4E8;">   : 0</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">uncompressed </span><span style="color:#B392F0;">size</span><span style="color:#E1E4E8;"> : 0</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">file name </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;">  : </span><span style="color:#79B8FF;">09</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">extra field </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">18</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">file comment </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;"> : </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">disk number </span><span style="color:#B392F0;">start</span><span style="color:#E1E4E8;">   : </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">internal file attributes        </span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">external file attributes        </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">A4</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">81</span></span>
<span class="line"><span style="color:#E1E4E8;">relative offset </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> local header </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">file </span><span style="color:#B392F0;">name</span><span style="color:#E1E4E8;"> (variable size): </span><span style="color:#79B8FF;">68</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">65</span><span style="color:#E1E4E8;"> 6</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> 6</span><span style="color:#79B8FF;">C</span><span style="color:#E1E4E8;"> 6</span><span style="color:#79B8FF;">F</span><span style="color:#E1E4E8;"> 2</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">74</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">78</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">74</span></span>
<span class="line"><span style="color:#E1E4E8;">extra </span><span style="color:#B392F0;">field</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">55</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">54</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">03</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">26</span><span style="color:#E1E4E8;"> 4</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">EF</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">68</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">75</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">78</span><span style="color:#E1E4E8;"> 0</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">F5</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">04</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">14</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 这里是根据 extra field length 的长度来获取的。</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">central file header </span><span style="color:#6F42C1;">signature</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;"> 4</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">02</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 中央目录头标识</span></span>
<span class="line"><span style="color:#24292E;">version made </span><span style="color:#6F42C1;">by</span><span style="color:#24292E;">: 1</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span></span>
<span class="line"><span style="color:#24292E;">version needed to </span><span style="color:#6F42C1;">extract</span><span style="color:#24292E;">: 0</span><span style="color:#005CC5;">A</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">general purpose bit </span><span style="color:#6F42C1;">flag</span><span style="color:#24292E;">:  </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">compression </span><span style="color:#6F42C1;">method</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">last mod file </span><span style="color:#6F42C1;">time</span><span style="color:#24292E;">: 1</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> 7</span><span style="color:#005CC5;">C</span></span>
<span class="line"><span style="color:#24292E;">last mod file </span><span style="color:#6F42C1;">date</span><span style="color:#24292E;">: 4</span><span style="color:#005CC5;">F</span><span style="color:#24292E;"> 5</span><span style="color:#005CC5;">B</span></span>
<span class="line"><span style="color:#24292E;">crc</span><span style="color:#D73A49;">-</span><span style="color:#005CC5;">32</span><span style="color:#24292E;">            : </span><span style="color:#005CC5;">52</span><span style="color:#24292E;"> 9</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">D6</span><span style="color:#24292E;"> 8</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">compressed </span><span style="color:#6F42C1;">size</span><span style="color:#24292E;">   : 0</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">uncompressed </span><span style="color:#6F42C1;">size</span><span style="color:#24292E;"> : 0</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">file name </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;">  : </span><span style="color:#005CC5;">09</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">extra field </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">18</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">file comment </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;"> : </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">disk number </span><span style="color:#6F42C1;">start</span><span style="color:#24292E;">   : </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">internal file attributes        </span><span style="color:#005CC5;">01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">external file attributes        </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">A4</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">81</span></span>
<span class="line"><span style="color:#24292E;">relative offset </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> local header </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">file </span><span style="color:#6F42C1;">name</span><span style="color:#24292E;"> (variable size): </span><span style="color:#005CC5;">68</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">65</span><span style="color:#24292E;"> 6</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> 6</span><span style="color:#005CC5;">C</span><span style="color:#24292E;"> 6</span><span style="color:#005CC5;">F</span><span style="color:#24292E;"> 2</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">74</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">78</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">74</span></span>
<span class="line"><span style="color:#24292E;">extra </span><span style="color:#6F42C1;">field</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">55</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">54</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">03</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">26</span><span style="color:#24292E;"> 4</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">EF</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">68</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">75</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">78</span><span style="color:#24292E;"> 0</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">F5</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">04</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">14</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 这里是根据 extra field length 的长度来获取的。</span></span></code></pre></div><h3 id="中央目录记录结尾" tabindex="-1">中央目录记录结尾 <a class="header-anchor" href="#中央目录记录结尾" aria-label="Permalink to &quot;中央目录记录结尾&quot;">​</a></h3><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#e1e4e8;">end of central dir signature    4 bytes  (0x06054b50)</span></span>
<span class="line"><span style="color:#e1e4e8;">number of this disk             2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">number of the disk with the start of the central directory  2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">total number of entries in the central directory on this disk  2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">total number of entries in the central directory           2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">size of the central directory   4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">offset of start of central directory with respect to the starting disk number        4 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">.ZIP file comment length        2 bytes</span></span>
<span class="line"><span style="color:#e1e4e8;">.ZIP file comment       (variable size)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292e;">end of central dir signature    4 bytes  (0x06054b50)</span></span>
<span class="line"><span style="color:#24292e;">number of this disk             2 bytes</span></span>
<span class="line"><span style="color:#24292e;">number of the disk with the start of the central directory  2 bytes</span></span>
<span class="line"><span style="color:#24292e;">total number of entries in the central directory on this disk  2 bytes</span></span>
<span class="line"><span style="color:#24292e;">total number of entries in the central directory           2 bytes</span></span>
<span class="line"><span style="color:#24292e;">size of the central directory   4 bytes</span></span>
<span class="line"><span style="color:#24292e;">offset of start of central directory with respect to the starting disk number        4 bytes</span></span>
<span class="line"><span style="color:#24292e;">.ZIP file comment length        2 bytes</span></span>
<span class="line"><span style="color:#24292e;">.ZIP file comment       (variable size)</span></span></code></pre></div><p>以当前的 zip 文件为例，我们可以看到 中央目录记录结尾 的内容如下：</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">end </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> central dir </span><span style="color:#B392F0;">signature</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">50</span><span style="color:#E1E4E8;"> 4</span><span style="color:#79B8FF;">B</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">05</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">06</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">number </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">disk</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">number </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> the disk </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> the start </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> the central </span><span style="color:#B392F0;">directory</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span>
<span class="line"><span style="color:#E1E4E8;">total number </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> entries </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> the central directory on </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">disk</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 存储的是文件总数</span></span>
<span class="line"><span style="color:#E1E4E8;">total number </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> entries </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> the central </span><span style="color:#B392F0;">directory</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">01</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 存储的是文件总数</span></span>
<span class="line"><span style="color:#E1E4E8;">size </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> the central </span><span style="color:#B392F0;">directory</span><span style="color:#E1E4E8;"> : 4</span><span style="color:#79B8FF;">F</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 中央目录区占据的字节大小。</span></span>
<span class="line"><span style="color:#E1E4E8;">offset </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> start </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> central directory </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> respect to the starting disk </span><span style="color:#B392F0;">number</span><span style="color:#E1E4E8;">: 4</span><span style="color:#79B8FF;">E</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#6A737D;">// 中央目录区开始的位置。</span></span>
<span class="line"><span style="color:#E1E4E8;">.</span><span style="color:#79B8FF;">ZIP</span><span style="color:#E1E4E8;"> file comment </span><span style="color:#B392F0;">length</span><span style="color:#E1E4E8;">: </span><span style="color:#79B8FF;">00</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">00</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">end </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> central dir </span><span style="color:#6F42C1;">signature</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">50</span><span style="color:#24292E;"> 4</span><span style="color:#005CC5;">B</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">05</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">06</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">number </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">disk</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">number </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> the disk </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> the start </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> the central </span><span style="color:#6F42C1;">directory</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span>
<span class="line"><span style="color:#24292E;">total number </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> entries </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the central directory on </span><span style="color:#005CC5;">this</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">disk</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 存储的是文件总数</span></span>
<span class="line"><span style="color:#24292E;">total number </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> entries </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> the central </span><span style="color:#6F42C1;">directory</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">01</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 存储的是文件总数</span></span>
<span class="line"><span style="color:#24292E;">size </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> the central </span><span style="color:#6F42C1;">directory</span><span style="color:#24292E;"> : 4</span><span style="color:#005CC5;">F</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 中央目录区占据的字节大小。</span></span>
<span class="line"><span style="color:#24292E;">offset </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> start </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> central directory </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> respect to the starting disk </span><span style="color:#6F42C1;">number</span><span style="color:#24292E;">: 4</span><span style="color:#005CC5;">E</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#6A737D;">// 中央目录区开始的位置。</span></span>
<span class="line"><span style="color:#24292E;">.</span><span style="color:#005CC5;">ZIP</span><span style="color:#24292E;"> file comment </span><span style="color:#6F42C1;">length</span><span style="color:#24292E;">: </span><span style="color:#005CC5;">00</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">00</span></span></code></pre></div><p>综上，我们大概了解了 zip 包协议的内容，并根据协议的内容读取了 案例文件 对应数据。</p><p>接下来，我们看看 <a href="https://stuk.github.io/jszip/documentation/api_jszip.html" target="_blank" rel="noreferrer">JSzip</a> 是怎么 “读懂” 这段数据的。</p><h2 id="jszip-是如何解析的" tabindex="-1">JSZip 是如何解析的？ <a class="header-anchor" href="#jszip-是如何解析的" aria-label="Permalink to &quot;JSZip 是如何解析的？&quot;">​</a></h2><p>依旧以 当前的案例文件 为准。</p><p>JSZip 内部流程大致是这样👇</p><h3 id="_1-定位-50-4b-05-06-找到-中央目录记录结尾-的位置" tabindex="-1">1. 定位 “50 4B 05 06”，找到 中央目录记录结尾 的位置 <a class="header-anchor" href="#_1-定位-50-4b-05-06-找到-中央目录记录结尾-的位置" aria-label="Permalink to &quot;1. 定位 “50 4B 05 06”，找到 中央目录记录结尾 的位置&quot;">​</a></h3><p>JSZip 先从文件尾部向前扫描，寻找 0x06054B50（50 4B 05 06），这是 End of Central Directory Record（中央目录的结束标志）。</p><p><img src="`+e+'" alt="读取 zip 文件内容"></p><p>找到之后，JSZip 会根据 offset of start of central directory with respect to the starting disk number 字段，找到中央目录区的开始位置。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">offset</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> centralDirectoryHeader.offsetOfStartOfCentralDirectoryWithRespectToTheStartingDiskNumber;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">offset</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> centralDirectoryHeader.offsetOfStartOfCentralDirectoryWithRespectToTheStartingDiskNumber;</span></span></code></pre></div><h3 id="_2-找到-中央目录区的开始位置-找到-中央目录区的结束位置-锁定中央目录区" tabindex="-1">2. 找到 中央目录区的开始位置 + 找到 中央目录区的结束位置, 锁定中央目录区 <a class="header-anchor" href="#_2-找到-中央目录区的开始位置-找到-中央目录区的结束位置-锁定中央目录区" aria-label="Permalink to &quot;2. 找到 中央目录区的开始位置 + 找到 中央目录区的结束位置, 锁定中央目录区&quot;">​</a></h3><p>找到中央目录区的开始位置后，JSZip 会根据 total number of entries in the central directory 字段，找到中央目录区的结束位置。</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">end</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> centralDirectoryHeader.offsetOfStartOfCentralDirectoryWithRespectToTheStartingDiskNumber </span><span style="color:#F97583;">+</span><span style="color:#E1E4E8;"> centralDirectoryHeader.sizeOfTheCentralDirectory;</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">end</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> centralDirectoryHeader.offsetOfStartOfCentralDirectoryWithRespectToTheStartingDiskNumber </span><span style="color:#D73A49;">+</span><span style="color:#24292E;"> centralDirectoryHeader.sizeOfTheCentralDirectory;</span></span></code></pre></div><p>找到中央目录区的结束位置后，JSZip 会根据 central directory header 字段，找到中央目录区的内容。</p><h3 id="_3-遍历中央目录区-找到每个文件的本地文件头" tabindex="-1">3. 遍历中央目录区，找到每个文件的本地文件头 <a class="header-anchor" href="#_3-遍历中央目录区-找到每个文件的本地文件头" aria-label="Permalink to &quot;3. 遍历中央目录区，找到每个文件的本地文件头&quot;">​</a></h3><p>找到每个文件的本地文件头后，JSZip 会根据 local file header 字段，找到每个文件的本地文件头的内容。</p><p><img src="'+t+'" alt="jszip 流程"></p><p>这就是 JSZip 自底向上的解析流程。</p>',46),y=[r];function E(i,F,C,d,B,h){return n(),a("div",null,y)}const u=s(c,[["render",E]]);export{b as __pageData,u as default};
