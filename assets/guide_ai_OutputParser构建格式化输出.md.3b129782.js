import{_ as s,o as n,c as a,Q as o}from"./chunks/framework.b6910bb2.js";const p="/vitePress-blob/assets/4.43d3c47e.png",m=JSON.parse('{"title":"OutputParser","description":"","frontmatter":{},"headers":[],"relativePath":"guide/ai/OutputParseræ„å»ºæ ¼å¼åŒ–è¾“å‡º.md","filePath":"guide/ai/OutputParseræ„å»ºæ ¼å¼åŒ–è¾“å‡º.md","lastUpdated":1754897584000}'),l={name:"guide/ai/OutputParseræ„å»ºæ ¼å¼åŒ–è¾“å‡º.md"},t=o(`<h1 id="outputparser" tabindex="-1">OutputParser <a class="header-anchor" href="#outputparser" aria-label="Permalink to &quot;OutputParser&quot;">â€‹</a></h1><p>OutputParseræ˜¯ä¸€ä¸ªç”¨äºè§£ææ¨¡å‹è¾“å‡ºçš„å·¥å…·ç±»ï¼Œå®ƒå¯ä»¥å¸®åŠ©ç”¨æˆ·å°†æ¨¡å‹è¾“å‡ºè§£æä¸ºç”¨æˆ·éœ€è¦çš„æ ¼å¼ã€‚</p><h2 id="string-output-parser" tabindex="-1">String Output Parser <a class="header-anchor" href="#string-output-parser" aria-label="Permalink to &quot;String Output Parser&quot;">â€‹</a></h2><p>StringOutputParseræ˜¯OutputParserçš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒå¯ä»¥å°†æ¨¡å‹è¾“å‡ºè§£æä¸ºå­—ç¬¦ä¸²ã€‚</p><p>å‰é¢çš„ä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨äº†StringOutputParseræ¥è§£ææ¨¡å‹è¾“å‡ºï¼Œè¿™é‡Œå°±ä¸è¿‡å¤šèµ˜è¿°äº†ã€‚</p><h2 id="structuredoutputparser-ç»“æ„åŒ–çš„è¾“å‡º" tabindex="-1">StructuredOutputParser ï¼ˆç»“æ„åŒ–çš„è¾“å‡ºï¼‰ <a class="header-anchor" href="#structuredoutputparser-ç»“æ„åŒ–çš„è¾“å‡º" aria-label="Permalink to &quot;StructuredOutputParser ï¼ˆç»“æ„åŒ–çš„è¾“å‡ºï¼‰&quot;">â€‹</a></h2><p>StructuredOutputParseræ˜¯OutputParserçš„å¦ä¸€ä¸ªå®ç°ç±»ï¼Œå®ƒå¯ä»¥å°†æ¨¡å‹è¾“å‡ºè§£æä¸ºç»“æ„åŒ–çš„æ•°æ®ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†æ¨¡å‹è¾“å‡ºè§£æä¸ºJSONæ ¼å¼çš„æ•°æ®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ›´æ–¹ä¾¿åœ°å¤„ç†æ¨¡å‹è¾“å‡ºã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨StructuredOutputParserçš„ä¾‹å­ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { StructuredOutputParser } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;langchain/output_parsers&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { PromptTemplate } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@langchain/core/prompts&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> StructuredOutputParser.</span><span style="color:#B392F0;">fromNamesAndDescriptions</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  answer: </span><span style="color:#9ECBFF;">&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  evidence: </span><span style="color:#9ECBFF;">&quot;ä½ å›ç­”ç”¨æˆ·é—®é¢˜æ‰€ä¾æ®çš„ç­”æ¡ˆ&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  confidence: </span><span style="color:#9ECBFF;">&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ ¼å¼æ˜¯ç™¾åˆ†æ•°&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { StructuredOutputParser } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;langchain/output_parsers&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { PromptTemplate } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@langchain/core/prompts&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> StructuredOutputParser.</span><span style="color:#6F42C1;">fromNamesAndDescriptions</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  answer: </span><span style="color:#032F62;">&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  evidence: </span><span style="color:#032F62;">&quot;ä½ å›ç­”ç”¨æˆ·é—®é¢˜æ‰€ä¾æ®çš„ç­”æ¡ˆ&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  confidence: </span><span style="color:#032F62;">&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ ¼å¼æ˜¯ç™¾åˆ†æ•°&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>å®šä¹‰è¿™ä¸ª praser çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡å®šæˆ‘ä»¬éœ€è¦çš„ Json è¾“å‡ºçš„ key å’Œå¯¹åº”çš„æè¿°ã€‚æ³¨æ„è¿™é‡Œçš„æè¿°è¦å†™å®Œæ•´ï¼ŒåŒ…æ‹¬ä½ çš„è¦æ±‚çš„æ ¼å¼ï¼ˆæ¯”å¦‚æˆ‘ä»¬è¿™é‡Œå†™çš„æ ¼å¼æ˜¯ç™¾åˆ†æ•°ï¼‰ï¼Œè¶Šæ¸…æ™° LLM è¶Šèƒ½è¿”å›ç»™ä½ éœ€è¦çš„æ•°å€¼ã€‚</p><p>æˆ‘ä»¬é€šè¿‡è°ƒç”¨ <code>getFormatInstructions</code> æ–¹æ³•æ¥è·å–æ ¼å¼åŒ–æŒ‡ä»¤ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(parser.</span><span style="color:#B392F0;">getFormatInstructions</span><span style="color:#E1E4E8;">())</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(parser.</span><span style="color:#6F42C1;">getFormatInstructions</span><span style="color:#24292E;">())</span></span></code></pre></div><p>è¾“å…¥ç»“æœå¦‚ä¸‹ ğŸ‘‡</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#E1E4E8;">You must format your output </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">JSON</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">value</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">that</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">adheres</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">to</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">a</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">given</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;JSON Schema&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">instance</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#9ECBFF;">&quot;JSON Schema&quot;</span><span style="color:#E1E4E8;"> is a declarative language that allows you to annotate and validate </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;"> documents.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">For example, the example </span><span style="color:#9ECBFF;">&quot;JSON Schema&quot;</span><span style="color:#E1E4E8;"> instance {{</span><span style="color:#9ECBFF;">&quot;properties&quot;</span><span style="color:#E1E4E8;">: {{</span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;">: {{</span><span style="color:#9ECBFF;">&quot;description&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;a list of test words&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;array&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;items&quot;</span><span style="color:#E1E4E8;">: {{</span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;string&quot;</span><span style="color:#E1E4E8;">}}}}}}, </span><span style="color:#9ECBFF;">&quot;required&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;">]}}}}</span></span>
<span class="line"><span style="color:#E1E4E8;">would match an object </span><span style="color:#F97583;">with</span><span style="color:#E1E4E8;"> one required property, </span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;">. The </span><span style="color:#9ECBFF;">&quot;type&quot;</span><span style="color:#E1E4E8;"> property specifies </span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;"> must be an </span><span style="color:#9ECBFF;">&quot;array&quot;</span><span style="color:#E1E4E8;">, and the </span><span style="color:#9ECBFF;">&quot;description&quot;</span><span style="color:#E1E4E8;"> property semantically describes it </span><span style="color:#F97583;">as</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;a list of test words&quot;</span><span style="color:#E1E4E8;">. </span><span style="color:#B392F0;">The</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">items</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">within</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">must</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">be</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">strings</span><span style="color:#E1E4E8;">.</span></span>
<span class="line"><span style="color:#E1E4E8;">Thus, the object {{</span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;bar&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;baz&quot;</span><span style="color:#E1E4E8;">]}} is a well</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">formatted instance </span><span style="color:#F97583;">of</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">this</span><span style="color:#E1E4E8;"> example </span><span style="color:#9ECBFF;">&quot;JSON Schema&quot;</span><span style="color:#E1E4E8;">. The object {{</span><span style="color:#9ECBFF;">&quot;properties&quot;</span><span style="color:#E1E4E8;">: {{</span><span style="color:#9ECBFF;">&quot;foo&quot;</span><span style="color:#E1E4E8;">: [</span><span style="color:#9ECBFF;">&quot;bar&quot;</span><span style="color:#E1E4E8;">, </span><span style="color:#9ECBFF;">&quot;baz&quot;</span><span style="color:#E1E4E8;">]}}}} is not well</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">formatted.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Your output will be parsed and type</span><span style="color:#F97583;">-</span><span style="color:#E1E4E8;">checked according to the provided schema instance, so make sure all fields </span><span style="color:#F97583;">in</span><span style="color:#E1E4E8;"> your output match the schema exactly and there are no trailing commas</span><span style="color:#F97583;">!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">Here is the </span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;"> Schema instance your output must adhere to. Include the enclosing markdown </span><span style="color:#B392F0;">codeblock</span><span style="color:#E1E4E8;">:</span></span>
<span class="line"><span style="color:#9ECBFF;">\` \`\`json</span></span>
<span class="line"><span style="color:#9ECBFF;">{&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:{&quot;answer&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;},&quot;evidence&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;ä½ å›ç­”ç”¨æˆ·é—®é¢˜æ‰€ä¾æ®çš„ç­”æ¡ˆ&quot;},&quot;confidence&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ ¼å¼æ˜¯ç™¾åˆ†æ•°&quot;}},&quot;required&quot;:[&quot;answer&quot;,&quot;evidence&quot;,&quot;confidence&quot;],&quot;additionalProperties&quot;:false,&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;}</span></span>
<span class="line"><span style="color:#9ECBFF;">\`</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">\` \`</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#24292E;">You must format your output </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">a</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">JSON</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">value</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">that</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">adheres</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">to</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">a</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">given</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;JSON Schema&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">instance</span><span style="color:#24292E;">.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#032F62;">&quot;JSON Schema&quot;</span><span style="color:#24292E;"> is a declarative language that allows you to annotate and validate </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;"> documents.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">For example, the example </span><span style="color:#032F62;">&quot;JSON Schema&quot;</span><span style="color:#24292E;"> instance {{</span><span style="color:#032F62;">&quot;properties&quot;</span><span style="color:#24292E;">: {{</span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;">: {{</span><span style="color:#032F62;">&quot;description&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;a list of test words&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;array&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;items&quot;</span><span style="color:#24292E;">: {{</span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;string&quot;</span><span style="color:#24292E;">}}}}}}, </span><span style="color:#032F62;">&quot;required&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;">]}}}}</span></span>
<span class="line"><span style="color:#24292E;">would match an object </span><span style="color:#D73A49;">with</span><span style="color:#24292E;"> one required property, </span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;">. The </span><span style="color:#032F62;">&quot;type&quot;</span><span style="color:#24292E;"> property specifies </span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;"> must be an </span><span style="color:#032F62;">&quot;array&quot;</span><span style="color:#24292E;">, and the </span><span style="color:#032F62;">&quot;description&quot;</span><span style="color:#24292E;"> property semantically describes it </span><span style="color:#D73A49;">as</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;a list of test words&quot;</span><span style="color:#24292E;">. </span><span style="color:#6F42C1;">The</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">items</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">within</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">must</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">be</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">strings</span><span style="color:#24292E;">.</span></span>
<span class="line"><span style="color:#24292E;">Thus, the object {{</span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;bar&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;baz&quot;</span><span style="color:#24292E;">]}} is a well</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">formatted instance </span><span style="color:#D73A49;">of</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">this</span><span style="color:#24292E;"> example </span><span style="color:#032F62;">&quot;JSON Schema&quot;</span><span style="color:#24292E;">. The object {{</span><span style="color:#032F62;">&quot;properties&quot;</span><span style="color:#24292E;">: {{</span><span style="color:#032F62;">&quot;foo&quot;</span><span style="color:#24292E;">: [</span><span style="color:#032F62;">&quot;bar&quot;</span><span style="color:#24292E;">, </span><span style="color:#032F62;">&quot;baz&quot;</span><span style="color:#24292E;">]}}}} is not well</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">formatted.</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Your output will be parsed and type</span><span style="color:#D73A49;">-</span><span style="color:#24292E;">checked according to the provided schema instance, so make sure all fields </span><span style="color:#D73A49;">in</span><span style="color:#24292E;"> your output match the schema exactly and there are no trailing commas</span><span style="color:#D73A49;">!</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">Here is the </span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;"> Schema instance your output must adhere to. Include the enclosing markdown </span><span style="color:#6F42C1;">codeblock</span><span style="color:#24292E;">:</span></span>
<span class="line"><span style="color:#032F62;">\` \`\`json</span></span>
<span class="line"><span style="color:#032F62;">{&quot;type&quot;:&quot;object&quot;,&quot;properties&quot;:{&quot;answer&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;},&quot;evidence&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;ä½ å›ç­”ç”¨æˆ·é—®é¢˜æ‰€ä¾æ®çš„ç­”æ¡ˆ&quot;},&quot;confidence&quot;:{&quot;type&quot;:&quot;string&quot;,&quot;description&quot;:&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ ¼å¼æ˜¯ç™¾åˆ†æ•°&quot;}},&quot;required&quot;:[&quot;answer&quot;,&quot;evidence&quot;,&quot;confidence&quot;],&quot;additionalProperties&quot;:false,&quot;$schema&quot;:&quot;http://json-schema.org/draft-07/schema#&quot;}</span></span>
<span class="line"><span style="color:#032F62;">\`</span><span style="color:#24292E;"> </span><span style="color:#032F62;">\` \`</span></span></code></pre></div><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæŒ‡ä»¤é¦–å…ˆä¼šå‘ŠçŸ¥ LLM è¾“å‡ºçš„ç±»å‹ã€‚</p><p>å…¶æ¬¡ï¼Œä¼šé€šè¿‡ few-shotï¼ˆä¸€ç§ prompt æŠ€å·§ï¼‰ï¼Œä¹Ÿå°±æ˜¯ç”¨ç¤ºä¾‹å‘Šè¯‰ LLM ä»€ä¹ˆæ˜¯ JSON Schemaï¼Œä»€ä¹ˆæƒ…å†µä¼šè¢«è§£ææˆåŠŸï¼Œä»€ä¹ˆæƒ…å†µä¸ä¼šè¢«è§£ææˆåŠŸã€‚</p><p>æœ€åï¼Œä¼šå‘ŠçŸ¥æˆ‘ä»¬çš„ JSON Schema æ˜¯ä»€ä¹ˆï¼Œæˆ‘ä»¬çš„è¾“å‡ºå¿…é¡»ç¬¦åˆè¿™ä¸ª Schemaï¼Œå¦åˆ™ä¼šè§£æå¤±è´¥ã€‚</p><p>é€šè¿‡è¿™æ ·ä¸€ç³»åˆ—çš„ promptï¼Œå°±èƒ½ä¿è¯å¤§æ¨¡å‹ä»¥æŒ‡å®šçš„æ ¼å¼è¾“å‡ºï¼Œæˆ‘ä»¬å®Œæˆ Chain çš„å…¶ä»–éƒ¨åˆ†çœ‹çœ‹æ•ˆæœï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { StructuredOutputParser } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;langchain/output_parsers&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { PromptTemplate } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@langchain/core/prompts&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> ollama </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./utils/ollama-llm.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> baidu </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./utils/baidu-llm.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">model</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> baidu;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> StructuredOutputParser.</span><span style="color:#B392F0;">fromNamesAndDescriptions</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  answer: </span><span style="color:#9ECBFF;">&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  evidence: </span><span style="color:#9ECBFF;">&quot;ä½ å›ç­”ç”¨æˆ·é—®é¢˜æ‰€ä¾æ®çš„ç­”æ¡ˆ&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">  confidence: </span><span style="color:#9ECBFF;">&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ ¼å¼æ˜¯ç™¾åˆ†æ•°&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// console.log(parser.getFormatInstructions());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">prompt</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PromptTemplate.</span><span style="color:#B392F0;">fromTemplate</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;å°½å¯èƒ½çš„ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ </span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">{instructions} </span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">{question}&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">chain</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> prompt.</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(model).</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(parser)</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">res</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> chain.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    question: </span><span style="color:#9ECBFF;">&quot;è’™å¨œä¸½èçš„ä½œè€…æ˜¯è°ï¼Ÿæ˜¯ä»€ä¹ˆæ—¶å€™ç»˜åˆ¶çš„ï¼Ÿ&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    instructions: parser.</span><span style="color:#B392F0;">getFormatInstructions</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">})</span></span>
<span class="line"><span style="color:#E1E4E8;">                               </span></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(res)</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { StructuredOutputParser } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;langchain/output_parsers&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { PromptTemplate } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@langchain/core/prompts&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> ollama </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./utils/ollama-llm.mjs&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> baidu </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./utils/baidu-llm.mjs&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">model</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> baidu;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> StructuredOutputParser.</span><span style="color:#6F42C1;">fromNamesAndDescriptions</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  answer: </span><span style="color:#032F62;">&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  evidence: </span><span style="color:#032F62;">&quot;ä½ å›ç­”ç”¨æˆ·é—®é¢˜æ‰€ä¾æ®çš„ç­”æ¡ˆ&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">  confidence: </span><span style="color:#032F62;">&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ ¼å¼æ˜¯ç™¾åˆ†æ•°&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// console.log(parser.getFormatInstructions());</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">prompt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PromptTemplate.</span><span style="color:#6F42C1;">fromTemplate</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;å°½å¯èƒ½çš„ç”¨ä¸­æ–‡å›ç­”ç”¨æˆ·é—®é¢˜ </span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">{instructions} </span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">{question}&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">chain</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> prompt.</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(model).</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(parser)</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">res</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> chain.</span><span style="color:#6F42C1;">invoke</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    question: </span><span style="color:#032F62;">&quot;è’™å¨œä¸½èçš„ä½œè€…æ˜¯è°ï¼Ÿæ˜¯ä»€ä¹ˆæ—¶å€™ç»˜åˆ¶çš„ï¼Ÿ&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    instructions: parser.</span><span style="color:#6F42C1;">getFormatInstructions</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">})</span></span>
<span class="line"><span style="color:#24292E;">                               </span></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(res)</span></span></code></pre></div><p><img src="`+p+`" alt="è¾“å‡ºç»“æœ"></p><h2 id="list-output-parser" tabindex="-1">List Output Parser <a class="header-anchor" href="#list-output-parser" aria-label="Permalink to &quot;List Output Parser&quot;">â€‹</a></h2><p>æ§åˆ¶å¤§æ¨¡å‹è¾“å‡ºæ˜¯æ•°ç»„</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { CommaSeparatedListOutputParser } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@langchain/core/output_parsers&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { PromptTemplate } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@langchain/core/prompts&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> ollama </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./utils/ollama-llm.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> baidu </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&#39;./utils/baidu-llm.mjs&#39;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">model</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> baidu;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">new</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">CommaSeparatedListOutputParser</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">prompt</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PromptTemplate.</span><span style="color:#B392F0;">fromTemplate</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;åˆ—å‡º3ä¸ª {country} çš„è‘—åçš„äº’è”ç½‘å…¬å¸.</span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">{instructions}&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">chain</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> prompt.</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(model).</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(parser);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">res</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> chain.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    country: </span><span style="color:#9ECBFF;">&quot;ä¸­å›½&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    instructions: parser.</span><span style="color:#B392F0;">getFormatInstructions</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(res); </span><span style="color:#6A737D;">// eg: [ &#39;ç™¾åº¦ï¼Œé˜¿é‡Œå·´å·´ï¼Œè…¾è®¯ã€‚&#39; ]</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { CommaSeparatedListOutputParser } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@langchain/core/output_parsers&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { PromptTemplate } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@langchain/core/prompts&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> ollama </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./utils/ollama-llm.mjs&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> baidu </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&#39;./utils/baidu-llm.mjs&#39;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">model</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> baidu;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">new</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">CommaSeparatedListOutputParser</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">prompt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PromptTemplate.</span><span style="color:#6F42C1;">fromTemplate</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;åˆ—å‡º3ä¸ª {country} çš„è‘—åçš„äº’è”ç½‘å…¬å¸.</span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">{instructions}&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">chain</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> prompt.</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(model).</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(parser);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">res</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> chain.</span><span style="color:#6F42C1;">invoke</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    country: </span><span style="color:#032F62;">&quot;ä¸­å›½&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    instructions: parser.</span><span style="color:#6F42C1;">getFormatInstructions</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(res); </span><span style="color:#6A737D;">// eg: [ &#39;ç™¾åº¦ï¼Œé˜¿é‡Œå·´å·´ï¼Œè…¾è®¯ã€‚&#39; ]</span></span></code></pre></div><h2 id="auto-fix-parser" tabindex="-1">Auto Fix Parser <a class="header-anchor" href="#auto-fix-parser" aria-label="Permalink to &quot;Auto Fix Parser&quot;">â€‹</a></h2><p>å½“ LLM è¿”å›çš„æ ¼å¼æœ‰é—®é¢˜æ—¶ï¼Œå¯ä»¥é€šè¿‡ Auto Fix Parser é‡æ–°æ ¡éªŒæ ¼å¼ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨ zodï¼Œä¸€ä¸ªç”¨æ¥éªŒè¯ js/ts ä¸­ç±»å‹æ˜¯å¦æ­£ç¡®çš„åº“ã€‚å…ˆä½¿ç”¨ zod å®šä¹‰ä¸€ä¸ªæˆ‘ä»¬éœ€è¦çš„ç±»å‹ï¼Œè¿™é‡Œæˆ‘ä»¬æŒ‡å®šäº†è¯„åˆ†éœ€è¦æ˜¯ä¸€ä¸ªæ•°å­—ï¼Œå¹¶ä¸”æ˜¯ [0, 100] çš„æ•°å­—ã€‚</p><p>ä¾‹å¦‚è¿™ä¸ªä¾‹å­ğŸ‘‡ï¼š</p><div class="language-js vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#6A737D;">// Auto Fix Parser</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { z } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;zod&quot;</span><span style="color:#E1E4E8;">; </span><span style="color:#6A737D;">// zod æ˜¯ä¸€ä¸ªå¯ä»¥éªŒè¯ js/ts æ˜¯å¦ç¬¦åˆç±»å‹çš„åº“</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { StructuredOutputParser, OutputFixingParser } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;langchain/output_parsers&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { PromptTemplate } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;@langchain/core/prompts&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> ollama </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./utils/ollama-llm.mjs&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">schema</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> z.</span><span style="color:#B392F0;">object</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    answer:  z.</span><span style="color:#B392F0;">string</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">describe</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">    confidence: z.</span><span style="color:#B392F0;">number</span><span style="color:#E1E4E8;">().</span><span style="color:#B392F0;">min</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">0</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">max</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">100</span><span style="color:#E1E4E8;">).</span><span style="color:#B392F0;">describe</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ»¡åˆ† 100&quot;</span><span style="color:#E1E4E8;">)</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">parser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> StructuredOutputParser.</span><span style="color:#B392F0;">fromZodSchema</span><span style="color:#E1E4E8;">(schema);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">prompt</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> PromptTemplate.</span><span style="color:#B392F0;">fromTemplate</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;å°½å¯èƒ½çš„å›ç­”ç”¨æˆ·é—®é¢˜ </span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">{instructions} </span><span style="color:#79B8FF;">\\n</span><span style="color:#9ECBFF;">{question}&quot;</span><span style="color:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">model</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> ollama;</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">chain</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> prompt.</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(model).</span><span style="color:#B392F0;">pipe</span><span style="color:#E1E4E8;">(parser);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">res</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> chain.</span><span style="color:#B392F0;">invoke</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    question: </span><span style="color:#9ECBFF;">&quot;è’™å¨œä¸½èçš„ä½œè€…æ˜¯è°ï¼Ÿæ˜¯ä»€ä¹ˆæ—¶å€™ç»˜åˆ¶çš„&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    instructions: parser.</span><span style="color:#B392F0;">getFormatInstructions</span><span style="color:#E1E4E8;">()</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(res);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">wrongOutput</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;answer&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;è’™å¨œä¸½èçš„ä½œè€…æ˜¯è¾¾èŠ¬å¥‡ï¼Œå¤§çº¦åœ¨16ä¸–çºªåˆæœŸï¼ˆ1503å¹´è‡³1506å¹´ä¹‹é—´ï¼‰å¼€å§‹ç»˜åˆ¶ã€‚&quot;</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#9ECBFF;">&quot;sources&quot;</span><span style="color:#E1E4E8;">: </span><span style="color:#9ECBFF;">&quot;90%&quot;</span><span style="color:#E1E4E8;"> </span></span>
<span class="line"><span style="color:#E1E4E8;">};</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// è‡ªåŠ¨æ ¡æ­£</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">fixParser</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> OutputFixingParser.</span><span style="color:#B392F0;">fromLLM</span><span style="color:#E1E4E8;">(model, parser);</span></span>
<span class="line"><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">output</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> fixParser.</span><span style="color:#B392F0;">parse</span><span style="color:#E1E4E8;">(</span><span style="color:#79B8FF;">JSON</span><span style="color:#E1E4E8;">.</span><span style="color:#B392F0;">stringify</span><span style="color:#E1E4E8;">(wrongOutput));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">console.</span><span style="color:#B392F0;">log</span><span style="color:#E1E4E8;">(output);</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#6A737D;">// Auto Fix Parser</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { z } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;zod&quot;</span><span style="color:#24292E;">; </span><span style="color:#6A737D;">// zod æ˜¯ä¸€ä¸ªå¯ä»¥éªŒè¯ js/ts æ˜¯å¦ç¬¦åˆç±»å‹çš„åº“</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { StructuredOutputParser, OutputFixingParser } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;langchain/output_parsers&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { PromptTemplate } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;@langchain/core/prompts&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> ollama </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./utils/ollama-llm.mjs&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">schema</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> z.</span><span style="color:#6F42C1;">object</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    answer:  z.</span><span style="color:#6F42C1;">string</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">describe</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;ç”¨æˆ·é—®é¢˜çš„ç­”æ¡ˆ&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">    confidence: z.</span><span style="color:#6F42C1;">number</span><span style="color:#24292E;">().</span><span style="color:#6F42C1;">min</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">0</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">max</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">100</span><span style="color:#24292E;">).</span><span style="color:#6F42C1;">describe</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;é—®é¢˜ç­”æ¡ˆçš„å¯ä¿¡åº¦è¯„åˆ†ï¼Œæ»¡åˆ† 100&quot;</span><span style="color:#24292E;">)</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">parser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> StructuredOutputParser.</span><span style="color:#6F42C1;">fromZodSchema</span><span style="color:#24292E;">(schema);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">prompt</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> PromptTemplate.</span><span style="color:#6F42C1;">fromTemplate</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;å°½å¯èƒ½çš„å›ç­”ç”¨æˆ·é—®é¢˜ </span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">{instructions} </span><span style="color:#005CC5;">\\n</span><span style="color:#032F62;">{question}&quot;</span><span style="color:#24292E;">);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">model</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> ollama;</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">chain</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> prompt.</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(model).</span><span style="color:#6F42C1;">pipe</span><span style="color:#24292E;">(parser);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">res</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> chain.</span><span style="color:#6F42C1;">invoke</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    question: </span><span style="color:#032F62;">&quot;è’™å¨œä¸½èçš„ä½œè€…æ˜¯è°ï¼Ÿæ˜¯ä»€ä¹ˆæ—¶å€™ç»˜åˆ¶çš„&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    instructions: parser.</span><span style="color:#6F42C1;">getFormatInstructions</span><span style="color:#24292E;">()</span></span>
<span class="line"><span style="color:#24292E;">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(res);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">wrongOutput</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;answer&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;è’™å¨œä¸½èçš„ä½œè€…æ˜¯è¾¾èŠ¬å¥‡ï¼Œå¤§çº¦åœ¨16ä¸–çºªåˆæœŸï¼ˆ1503å¹´è‡³1506å¹´ä¹‹é—´ï¼‰å¼€å§‹ç»˜åˆ¶ã€‚&quot;</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#032F62;">&quot;sources&quot;</span><span style="color:#24292E;">: </span><span style="color:#032F62;">&quot;90%&quot;</span><span style="color:#24292E;"> </span></span>
<span class="line"><span style="color:#24292E;">};</span></span>
<span class="line"><span style="color:#24292E;">  </span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D;">// è‡ªåŠ¨æ ¡æ­£</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">fixParser</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> OutputFixingParser.</span><span style="color:#6F42C1;">fromLLM</span><span style="color:#24292E;">(model, parser);</span></span>
<span class="line"><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">output</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> fixParser.</span><span style="color:#6F42C1;">parse</span><span style="color:#24292E;">(</span><span style="color:#005CC5;">JSON</span><span style="color:#24292E;">.</span><span style="color:#6F42C1;">stringify</span><span style="color:#24292E;">(wrongOutput));</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">console.</span><span style="color:#6F42C1;">log</span><span style="color:#24292E;">(output);</span></span></code></pre></div><p>å¯èƒ½ä¼šæœ‰æœ‹å‹é—®ï¼Œå¦‚æœæˆ‘æŠŠç”¨æˆ·çš„é—®é¢˜ä¹Ÿç»™ fixParserï¼Œè¿™æ ·ä¸å°±å¾—åˆ°ä¸€ä¸ªæ­£ç¡®çš„ç­”æ¡ˆå’Œæ­£ç¡®çš„æ ¼å¼äº†ä¹ˆï¼Ÿ åœ¨æˆ‘ä»¬çš„ demo ä¸­å½“ç„¶æ˜¯å¯ä»¥çš„ï¼Œä½†å®é™…å·¥ç¨‹ä¸­ï¼Œå¼•å¯¼ llm è¿”å›æ•°æ®çš„ prompt å¯èƒ½éå¸¸å·¨å¤§ï¼Œéå¸¸æ¶ˆè€— tokenï¼Œæˆ‘ä»¬ä½¿ç”¨ fixParser å°±æ˜¯ç”¨è¾ƒå°‘çš„æˆæœ¬å»ä¿®å¤è¿™ä¸ªè¾“å‡ºï¼Œæ¥èŠ‚çº¦é‡å¤è°ƒç”¨çš„æˆæœ¬ã€‚æ‰€ä»¥æŠŠåŸæ–‡ä¹Ÿç»™ fixParser çš„è¯ï¼Œå°±è¾¾ä¸åˆ°æˆæœ¬èŠ‚çº¦çš„ç›®çš„äº†ã€‚</p><p>åœ¨è¿›ä¸€æ­¥èŠ‚çº¦æˆæœ¬çš„èƒŒæ™¯ä¸‹ï¼Œæˆ‘ä»¬æ˜¯å¯ä»¥ç”¨å¯¹ GPT4 çš„é”™è¯¯è¾“å‡ºç”¨ GPT3.5 çš„ fixer æ¥ä¿®å¤ï¼Œç”šè‡³æ˜¯ç”¨ä¸€äº›å¼€æºæ¨¡å‹æ¥è¿›è¡Œä¿®å¤ï¼Œå› ä¸ºåœ¨è¿™ä¸ªåœºæ™¯ä¸‹ï¼Œå¹¶ä¸éœ€è¦æ¨¡å‹å…·æœ‰å¤ªé«˜çš„è´¨é‡ï¼Œé€šè¿‡å¤šæ¨¡å‹çš„ååŒæ¥é™ä½æˆæœ¬ã€‚</p>`,31),e=[t];function r(c,E,y,u,i,F){return n(),a("div",null,e)}const d=s(l,[["render",r]]);export{m as __pageData,d as default};
