# å¦‚ä½•ç»˜åˆ¶ä¸€ä¸ªå›¾å½¢

ä¸Šä¸€èŠ‚ä¸­ï¼Œå¤§è‡´äº†è§£äº† Fabric çš„å†…éƒ¨ç»“æ„ï¼Œå¹¶ä¸”çŸ¥é“ Fabric.js æ‹¥æœ‰ä¿©å±‚ Canvasã€‚

ä¸Šå±‚ Canvas ç§°ä¹‹ä¸ºåŠ¨æ€å±‚ï¼Œç”¨äºå¤„ç†äº¤äº’ç›¸å…³ä»¥åŠäº‹ä»¶ç»‘å®š

ä¸‹å±‚ Canvas ç§°ä¹‹ä¸ºé™æ€å±‚ï¼Œç”¨äºè·å–æ•°æ®ï¼Œé€šè¿‡æ•°æ®ç»˜åˆ¶å›¾å½¢

ä¹‹å‰æœ‰ç¼–å†™è¿‡ React çš„åŒå­¦åº”è¯¥å¯¹çˆ¶å­ç»„ä»¶çš„å•å‘æ•°æ®æµæœ‰ä¸€å®šçš„å°è±¡ï¼Œè€Œ Fabric.js çš„åˆ†å±‚ç»“æ„è®¾è®¡å°±å¾ˆç±»ä¼¼äºè¿™ç§å•å‘æ•°æ®æµæ€æƒ³ï¼Œ

åŠ¨æ€å±‚ç”¨äºè·å–æ•°æ®è¾“å‡ºåˆ°é™æ€å±‚è¿›è¡Œæ¸²æŸ“ã€‚

åœ¨è¿™ä¸€èŠ‚ä¸­ï¼Œæˆ‘ä»¬å°†ä»¥ç»˜åˆ¶çŸ©å½¢ä¸ºä¾‹ï¼Œäº†è§£ Fabric.js æ˜¯å¦‚ä½•å®ç°çŸ©å½¢çš„ç»˜åˆ¶çš„ï¼Ÿ

## Fabric.js æ˜¯å¦‚ä½•ç»˜åˆ¶çŸ©å½¢çš„

åœ¨ Fabric.js ä¸­ç»˜åˆ¶çŸ©å½¢ä¹Ÿéå¸¸ç®€å•ï¼Œåªéœ€è¦åˆå§‹åŒ–ç”»å¸ƒï¼Œæ·»åŠ çŸ©å½¢å¯¹è±¡å³å¯ï¼Œä»£ç å¦‚ä¸‹ğŸ‘‡:

```html
<!-- html -->
<canvas id="canvas"></canvas>
```

```js
// js
const canvas = new fabric.Canvas('canvas');
canvas.setWidth(window.innerWidth);
canvas.setHeight(window.innerHeight);


const rect = new fabric.Rect({
    left: 0, //è·ç¦»å·¦è¾¹çš„è·ç¦»
    top: 0, //è·ç¦»ä¸Šè¾¹çš„è·ç¦»
    fill: "red", //å¡«å……çš„é¢œè‰²
    width: 200, //çŸ©å½¢å®½åº¦
    height: 200, //çŸ©å½¢é«˜åº¦
});

canvas.add(rect);
```

é€šè¿‡ä»£ç å¯ä»¥çœ‹åˆ°ï¼ŒFabric.js é€šè¿‡å®ä¾‹åŒ–å¯¹è±¡çš„æ–¹å¼å°† Canvas çš„ç»˜åˆ¶é€»è¾‘è¿›è¡Œçš„éšè—ï¼Œä½¿ç”¨è€…åªéœ€è¦å…³å¿ƒä¼ å…¥å¯¹åº”çš„å‚æ•°å³å¯åœ¨ Canvas ä¸­ç»˜åˆ¶å‡ºç›¸å¯¹åº”çš„å…ƒç´ ã€‚



![åˆå§‹çŠ¶æ€å›¾](./../../public/assets/fabric/7.png)

## åˆå§‹åŒ–ç”»å¸ƒ

åœ¨æºç ä¸­ï¼Œ new Fabric.Canvas ä¼šåˆå§‹åŒ–åŠ¨æ€å±‚ã€é™æ€å±‚ä»¥åŠç¼“å†²å±‚ Canvasã€‚

![åˆå§‹çŠ¶æ€å›¾](./../../public/assets/fabric/8.png)

è¿›è€Œå¯¹ Canvas è¿›è¡Œåˆ†è¾¨ç‡çŸ«æ­£çš„æ“ä½œï¼Œä¸ºä½•éœ€è¦åšåˆ†è¾¨ç‡çŸ«æ­£ï¼Œå¯ä»¥é€šè¿‡è¿™ç¯‡æ–‡ç«  [Canvas å°ºå¯¸ä¸åˆ†è¾¨ç‡çŸ«æ­£](https://enson0131.github.io/vitePress-blob/guide/canvas/Canvas%E5%B0%BA%E5%AF%B8%E5%8F%8A%E5%88%86%E8%BE%A8%E7%8E%87%E7%9F%AB%E6%AD%A3) æŸ¥çœ‹ 

![alt text](./../../public/assets/fabric/9.png)

åŠ¨æ€å±‚ Canvas è¿˜ä¼šåšäº‹ä»¶ç»‘å®šçš„é€»è¾‘æ“ä½œğŸ‘‡

![alt text](./../../public/assets/fabric/10.png)

è€Œé™æ€å±‚ Canvas å°†æ§åˆ¶æ¸²æŸ“ ğŸ‘‡

```js
fabric.StaticCanvas = fabric.util.createClass(fabric.CommonMethods, {
    initialize: function (el, options) {
        options || (options = {});
        this.renderAndResetBound = this.renderAndReset.bind(this);
        this.requestRenderAllBound = this.requestRenderAll.bind(this);
        this._initStatic(el, options);
    },
})
```

è¿™é‡Œé¢æœ€ä¸»è¦çš„é€»è¾‘å°±æ˜¯ `requestRenderAll`, è¿™ä¸ªæ–¹æ³•å°±ä¼šè°ƒç”¨ `renderCanvas` çš„æ–¹æ³•

![alt text](./../../public/assets/fabric/11.png)

åœ¨ _renderObjects ä¸­å°†éå†æ‰€æœ‰çš„å…ƒç´ ï¼Œè¿›è¡Œæ¸²æŸ“ã€‚

```js
_renderObjects: function(ctx, objects) {
    var i, len;
    for (i = 0, len = objects.length; i < len; ++i) {
    objects[i] && objects[i].render(ctx);
    }
}
```

## å®ä¾‹åŒ–å¯¹è±¡

è™½ç„¶æˆ‘ä»¬å·²ç»æ˜ç™½äº† canvas çš„ç»˜åˆ¶åŸç†ï¼Œä½†æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ˆ2då…ƒç´ ï¼‰åˆ°åº•æ˜¯æ€ä¹ˆç»˜åˆ¶åˆ° canvas ä¸Šå»çš„ï¼Œå®ƒä»¬çš„ç§»åŠ¨æ€ä¹ˆå®ç°çš„ï¼Ÿå…·ä½“ç»†èŠ‚æˆ‘ä»¬è¿˜ä¸æ˜¯å¾ˆæ¸…æ¥šã€‚ 


fabric.Object æ˜¯å…ƒç´ çš„æ ¹ç±»å‹ï¼Œå› æ­¤éœ€è¦ä» fabric.Object æ ¹ç±»å‹çœ‹èµ·äº†ã€‚

ç”±äº fabric ä¸­çš„ 2d å…ƒç´ éƒ½æ˜¯ä»¥é¢å‘å¯¹è±¡çš„å½¢å¼å®ç°çš„, è€Œ Rect ï¼ˆçŸ©å½¢ç±»ï¼‰ ç»§æ‰¿ fabric.Objectï¼Œå®ç°äº†è‡ªå·±çš„ render æ–¹æ³•ï¼Œ

æˆ‘ä»¬å°†é€šè¿‡ä¸€å¼  UML ç±»å›¾æ›´ç›´è§‚çš„æ–¹ä¾¿æˆ‘ä»¬çš„ç†è§£ã€‚

![alt text](./../../public/assets/fabric/16.png)


ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºå„ä¸ªå…ƒç´ ç±»å°†å®ç°è‡ªå·±çš„ render æ–¹æ³•ï¼Œé€šè¿‡è°ƒç”¨ render æ–¹æ³•ï¼Œå°†å„è‡ªå›¾å½¢ç»˜åˆ¶åˆ° Canvas ä¸­ã€‚

è€Œåœ¨æ‰§è¡Œ canvas.add çš„æ—¶å€™ï¼Œä¼šå°†å…ƒç´ å¯¹è±¡ push åˆ°ä¸€ä¸ªæ•°æ®æ•°ç»„å†…ï¼Œè¿›è¡Œéå†æ¸²æŸ“ã€‚

## å‚è€ƒ
- https://juejin.cn/post/7103457175413981191
- https://keelii.com/2021/05/09/fabricjs-internals